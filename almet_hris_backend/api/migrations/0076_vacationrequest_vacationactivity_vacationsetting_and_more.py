# Generated by Django 5.2.1 on 2025-09-21 21:17

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0075_employeearchive_api_employe_origina_e96706_idx'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='VacationRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('request_id', models.CharField(editable=False, max_length=50, unique=True)),
                ('request_type', models.CharField(choices=[('IMMEDIATE', 'Request Immediately'), ('SCHEDULED', 'Scheduled')], max_length=20)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('return_date', models.DateField(editable=False)),
                ('number_of_days', models.DecimalField(decimal_places=1, editable=False, max_digits=5)),
                ('comment', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('DRAFT', 'Draft'), ('IN_PROGRESS', 'In Progress'), ('PENDING_LINE_MANAGER', 'Pending Line Manager Approval'), ('PENDING_HR', 'Pending HR Approval'), ('APPROVED', 'Approved'), ('REJECTED_LINE_MANAGER', 'Rejected by Line Manager'), ('REJECTED_HR', 'Rejected by HR'), ('CANCELLED', 'Cancelled'), ('COMPLETED', 'Completed')], default='DRAFT', max_length=30)),
                ('line_manager_approved_at', models.DateTimeField(blank=True, null=True)),
                ('line_manager_comment', models.TextField(blank=True)),
                ('hr_approved_at', models.DateTimeField(blank=True, null=True)),
                ('hr_comment', models.TextField(blank=True)),
                ('rejected_at', models.DateTimeField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('edit_count', models.PositiveIntegerField(default=0)),
                ('last_edited_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_%(class)ss', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vacation_requests', to='api.employee')),
                ('hr_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='hr_vacation_approvals', to=settings.AUTH_USER_MODEL)),
                ('hr_representative', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vacation_requests_hr_approval', to='api.employee')),
                ('last_edited_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vacation_edits', to=settings.AUTH_USER_MODEL)),
                ('line_manager', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vacation_requests_to_approve', to='api.employee')),
                ('line_manager_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='line_manager_vacation_approvals', to=settings.AUTH_USER_MODEL)),
                ('rejected_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='vacation_rejections', to=settings.AUTH_USER_MODEL)),
                ('requester', models.ForeignKey(help_text="Person who made the request (for 'for my employee' cases)", on_delete=django.db.models.deletion.CASCADE, related_name='vacation_requests_made', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Vacation Request',
                'verbose_name_plural': 'Vacation Requests',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='VacationActivity',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('activity_type', models.CharField(choices=[('CREATED', 'Request Created'), ('SUBMITTED', 'Request Submitted'), ('APPROVED_LINE_MANAGER', 'Approved by Line Manager'), ('REJECTED_LINE_MANAGER', 'Rejected by Line Manager'), ('APPROVED_HR', 'Approved by HR'), ('REJECTED_HR', 'Rejected by HR'), ('EDITED', 'Request Edited'), ('CANCELLED', 'Request Cancelled'), ('REGISTERED', 'Vacation Registered')], max_length=30)),
                ('description', models.TextField()),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('performed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('vacation_request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='activities', to='api.vacationrequest')),
            ],
            options={
                'verbose_name': 'Vacation Activity',
                'verbose_name_plural': 'Vacation Activities',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='VacationSetting',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('non_working_days', models.JSONField(default=list, help_text='List of non-working dates (holidays, etc.) in YYYY-MM-DD format')),
                ('allow_negative_balance', models.BooleanField(default=False, help_text='Allow vacation requests when remaining balance is zero')),
                ('max_schedule_edits', models.PositiveIntegerField(default=3, help_text='Maximum number of times a scheduled vacation can be edited')),
                ('notification_days_before', models.PositiveIntegerField(default=7, help_text='Days before vacation start to send notifications')),
                ('notification_frequency', models.PositiveIntegerField(default=1, help_text='How many times to send notifications')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('default_hr_representative', models.ForeignKey(blank=True, help_text='Default HR representative for vacation approvals', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='hr_vacation_settings', to='api.employee')),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_%(class)ss', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Vacation Setting',
                'verbose_name_plural': 'Vacation Settings',
            },
        ),
        migrations.CreateModel(
            name='VacationType',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('name', models.CharField(max_length=100, unique=True)),
                ('code', models.CharField(max_length=20, unique=True)),
                ('description', models.TextField(blank=True)),
                ('requires_approval', models.BooleanField(default=True)),
                ('affects_balance', models.BooleanField(default=True)),
                ('max_consecutive_days', models.PositiveIntegerField(blank=True, help_text='Maximum consecutive days for this type', null=True)),
                ('color', models.CharField(default='#3B82F6', max_length=7)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_%(class)ss', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Vacation Type',
                'verbose_name_plural': 'Vacation Types',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='VacationSchedule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('number_of_days', models.DecimalField(decimal_places=1, max_digits=5)),
                ('status', models.CharField(choices=[('SCHEDULED', 'Scheduled'), ('REGISTERED', 'Registered')], default='SCHEDULED', max_length=20)),
                ('edit_count', models.PositiveIntegerField(default=0)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_%(class)ss', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vacation_schedules', to='api.employee')),
                ('vacation_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='api.vacationtype')),
            ],
            options={
                'verbose_name': 'Vacation Schedule',
                'verbose_name_plural': 'Vacation Schedules',
                'ordering': ['start_date'],
            },
        ),
        migrations.AddField(
            model_name='vacationrequest',
            name='vacation_type',
            field=models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='api.vacationtype'),
        ),
        migrations.CreateModel(
            name='EmployeeVacationBalance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('year', models.PositiveIntegerField()),
                ('start_balance', models.DecimalField(decimal_places=1, default=0, help_text='Starting balance for the year', max_digits=5)),
                ('yearly_balance', models.DecimalField(decimal_places=1, default=0, help_text='Yearly allocated vacation days', max_digits=5)),
                ('used_days', models.DecimalField(decimal_places=1, default=0, help_text='Days already used', max_digits=5)),
                ('scheduled_days', models.DecimalField(decimal_places=1, default=0, help_text='Days scheduled but not yet taken', max_digits=5)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='deleted_%(class)ss', to=settings.AUTH_USER_MODEL)),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vacation_balances', to='api.employee')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Employee Vacation Balance',
                'verbose_name_plural': 'Employee Vacation Balances',
                'ordering': ['-year', 'employee__employee_id'],
                'unique_together': {('employee', 'year')},
            },
        ),
        migrations.AddIndex(
            model_name='vacationrequest',
            index=models.Index(fields=['employee', 'status'], name='api_vacatio_employe_87b73f_idx'),
        ),
        migrations.AddIndex(
            model_name='vacationrequest',
            index=models.Index(fields=['start_date', 'end_date'], name='api_vacatio_start_d_b425ec_idx'),
        ),
        migrations.AddIndex(
            model_name='vacationrequest',
            index=models.Index(fields=['status', 'created_at'], name='api_vacatio_status_74e8d9_idx'),
        ),
    ]
